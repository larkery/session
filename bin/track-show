#!/run/current-system/sw/bin/perl

use strict;
use warnings;
use v5.24;
use POSIX qw( strftime );

open(my $log, "<", "$ENV{HOME}/.local/tracker.db")
    or die "Can't open trackerdb";

my %start = ();
my %state = ();
my %blocks = ();

while (<$log>) {
    chomp;
    if (/^([0-9]+) (\w+) ?(.+)$/) {
        my $time = $1;
        my $event = $2;
        my $msg = $3;
        my $last_time = $start{$event};
        if ($last_time) {
            my $last_state = $state{$event};
            my $delta = $time - $last_time;

            my $block = strftime("W%W %a %e %b %H",
                                 localtime($last_time));

            # chop up the msg
        }
        $state{$event} = $msg;
        $start{$event} = $time;
    }
}
