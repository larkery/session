#!/usr/bin/env bash

NEW=$(notmuch count -- tag:new and not from:me)
SUB=$(notmuch search --format=json -- tag:new and not from:me | jq -j '.[0:5]|.[]|.subject+"\n"')
notmuch tag -new -- tag:new

"$SESSION_DIR/scripts/refile" >/dev/null

if [ ! "$?" -eq 0 ]
then
    echo "ERROR: refiler was not happy"
fi

if [ $NEW -ne 0 ]
then
    notify "$NEW new mails" "$SUB"
fi
